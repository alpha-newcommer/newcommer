# Java講習



<!-- Javaの実行とライブラリ使用まで -->

>>>>
## 基本編

----
### はろーわーるど　かけるよね？
IDEなんて使わせないよ？  
テキストエディタとコマンドプロンプトで頑張れ。  
* 適当に「work\hello」フォルダをどこかに作ろう。ココ、以降はbaseフォルダって言います。
* 「App.java」を作って「はろーわーるど」って標準出力させよう。
  * package は 『com.sample.app』 で作ってね。
  * 文字コードは『UTF-8』で作ってね。

----
### Java実行時の引数を表示してみよう。
* さっきの "はろーわーるど" の横に、実行時の引数の値を足そうか。
* 実行イメージは↓みたいな感じ。
```
> java com.sample.app.App ホゲホゲ
はろーわーるどホゲホゲ
```

----
### 実行時引数の指定忘れ対策しよう。
例外スタック垂れ流しはダサい。  
* 引数が指定されなかったら、 "引数が指定されていません。"ってエラー出力をしよう。

----
### 便利ライブラリでもっと格好よく
まだダサい。  
引数（配列）が空の場合の処理を便利ライブラリのcommons-lang3のAPIに置き換えよう。  
* [commons-lang3のjar](https://mvnrepository.com/artifact/org.apache.commons/commons-lang3/3.7)
からjarをダウンロードして、baseフォルダ下の「lib」フォルダ配下に置こう。
* [commons-lang3のAPI](https://commons.apache.org/proper/commons-lang/javadocs/api-3.4/)
でArrayUtilsあたりを調べて、空かどうか判定するようソースを書き換えよう。


<!-- IO処理 -->

>>>>
## IO編

----
### ファイル内容でも出力してみようか。
適当なテキストファイル（UTF-8）を作って出力してみよう。  
* テキスト内容は3行以上書いてね。
* baseフォルダ配下にファイルは置いてね。
* [Java8のAPI](https://docs.oracle.com/javase/jp/8/docs/api/)
  の「java.io」パッケージ下の以下クラスを使ってコーディングしよう。
  + FileReader
  + BufferedReader

----
### 文字コード
さっきのテキストファイルに、日本語で何か文字を入れて、再度実行してみよう。  
変な文字が出力された？それが文字化けです。  
回避方法は２つ。  
* 実行時オプションに『-Dfile.encoding=UTF-8』を追加。  
* プログラムで以下を使ってで文字コードを指定するように変更する。
 + FileInputStream
 + InputStreamReader

----
### Javaにおけるストリームを理解しよう
Javaプログラムの入出力を「ストリーム」と呼んでいます。  
ファイル然り、ネットワーク然り、コンソールの入出力然り、
Javaプログラムとプログラム外との文字やデータの入出力（Input/Output 以降"IO"）の概念をストリームと言います。

----
### コンソール入力を受付けよう
今度は、ファイルではなく、コンソールの入力ストリームを使ってみよう。
* コンソール入力は、以下を組み合わせて使うといいよ。
  + System.in （コンソールの入力ストリーム）
  + InputStreamReader
  + BufferedReader
* 「ファイルパスを入力してください。＞」と出力し、その横にユーザ入力させましょう。
* 入力されたファイルパスの内容を出力しよう。



<!-- 環境構築 -->

>>>>
## 環境構築編

----
### 開発環境を整えよう（STS）
まだIDE使ってないとかダサい。  
STSというIDE使いましょう。
* STSをダウンロードして、自端末に展開してSTSを起動しよう。
* ビルドパス等々の設定をしよう。

----
### 開発環境を整えよう（Maven）
まだ手動で設定とかしてるの？ださい。  
Mavenというプロジェクト管理ツールを使おう。
* Mavenとは（講義）
* Mavenをインストールしよう。
* 以下コマンドを「work」フォルダで実行し、Mavenプロジェクトを作ろう
  『ishinoy-zoo-app』のところは、自分のユーザIDに書き換えてね。

``` bat
mvn archetype:generate ^
-DarchetypeGroupId=org.apache.maven.archetypes ^
-DarchetypeArtifactId=maven-archetype-quickstart ^
-DgroupId=com.example ^
-DartifactId=ishinoy-zoo-app ^
-Dversion=1.0-SNAPSHOT
```

----
### 開発環境を整えよう（Git）
ファイルを作ったり、更新したりしていると、  
前の状態に戻したいってなったりするよね。  
サーバに保存しておこう。あれ、最新ってどれだっけ・・・  
そんな状況を解決してくれる、Gitという構成管理ツールを使おう。
* Gitとは（講義）
* Gitをインストールしよう。
* GitBucketにアクセスして自分のリポジトリを作ろう。
* GitBucketで作成したリポジトリの初期設定をしよう。

----
### 開発環境を整えよう（Jenkins/Sonar）
よーし、準備万端！さっそく書いていこう！  
・・・の前に。
今後、レビュー依頼を出す前に静的解析を行おう。
* 静的解析とは（講義）


<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（アプリ仕様）

----
### 作成するアプリの概要
以下のような動物園アプリを作ってもらいます。
* 色々な檻に色々な動物を入れます。
* 5種のリボンを檻の中の動物に付けられます。
* 全ての檻と、檻に入っている動物の一覧表示をします。
* 5種のリボン付き動物の一覧を表示します。

----
### 檻の基本仕様
色々な種類の檻がありますが、基本は以下の仕様に則ります。
* 檻に動物を入れる際は、動物名と体重を指定します。
* 檻には色々な制限があり、違反する場合は動物を入れられません。  
  （個体体重、総重量、総数等）

----
### 動物の基本仕様
色々な動物がいます。  
基本は以下の情報を持ちます。
* ID
* 動物名
* 体重（kg）

----
### リボンの基本仕様
以下の5種類のリボンがあります。  
1個ずつ、5頭の動物へ付けることが出来ます。
* 草食アイドルリボン
* 肉食系女子リボン
* 空の王者風リボン
* ふわふわ代表リボン
* お触られマスターリボン



<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（作成）
以下の４つを意識して作っていきましょう。
* ポリモーフィズム
* カプセル化
* 継承
* ファクトリ

----
### 作成工程
以下の工程で作成していきましょ。
* メニューの作成（入力受付け処理部分）
* 動物の作成
* 檻の作成
* 動物を檻に入れる処理の作成
* 全動物一覧表示機能の作成
* リボンの作成
* 動物にリボンを贈呈する処理の作成
* リボン付動物一覧表示機能の作成

----
### メニューの作成
概要から、以下のメニューが必要そう。
* 1:檻に動物を入れる
* 2:動物にリボン贈呈
* 3:全動物リスト表示
* 4:リボン付き動物リスト表示

各番号が入力されたらそれぞれの処理を行うよう、  
入力受付け及び分岐処理を作ろう。  
処理内容は…、とりあえず今は、処理名でも出力しておこう。

----
### 動物の作成
檻に入れる動物のクラスを作ろう。  
とりあえず、以下の動物クラスを作ろう。

| コード | 動物名        |
|:-------|:--------------|
|   1    | トラ          |
|   2    | シマウマ      |
|   3    | ウサギ        |
|   4    | フクロウ      |

----
### 檻の作成
以下の仕様の檻クラスを作ろう。

| コード | 檻名          | 制限                       |
|:-------|:--------------|:---------------------------|
|   1    | 普通の檻      | 250kgまでの動物2頭まで。   |
|   2    | 頑丈な檻      | 3頭まで。                  |
|   3    | 広い檻        | 総重量1000kgまで。         |
|   4    | かわいい檻    | 1匹2kgまで。               |

----
### 動物を檻に入れる処理の作成（１）
入れる檻を選択させよう。  
処理の順番は以下かな。  
* 檻のコードと檻名を一覧表示
* 使用する檻のコードを入力させる
* 入力されたコードに対応する檻のオブジェクト取得する

----
### 動物を檻に入れる処理の作成（２）
続けて、入れる動物の動物名と体重を入力させよう。  
処理の順番は以下かな。  
* 動物のコードと動物名を一覧表示
* 動物のコードを入力させる
* 入力されたコードから動物のオブジェクト取得する
* 動物のオブジェクトにIDを振る  
* 動物の体重を入力させる
* 動物のオブジェクトに体重を設定

----
### 動物を檻に入れる処理の作成（３）
さらに続けて、動物を檻に入れよう。  
処理の順序は以下かな。
* 選ばれた檻のオブジェクトに選ばれた動物を格納可能かチェックする
* チェックNGなら警告を出力し、最初のメニューへ戻る
* チェックOKならその動物オブジェクトを檻に格納し、最初のメニューへ戻る

----
### 全動物一覧表示機能の作成
動物の一覧を表示しよう。
表示する内容は以下。
* 檻名
* 檻に入っている動物のID
* 檻に入っている動物の動物名
* 檻に入っている動物の体重
* 檻に入っている動物のリボン名（今は空白でOK）

----
### リボン管理クラスの作成
以下を管理しよう。
* リボンとリボンを付与されている動物のオブジェクト
* 以下の5種類のリボン情報

| コード | リボン名                  |
|:-------|:--------------------------|
|   1    | 草食アイドルリボン        | 
|   2    | 肉食系女子リボン          |
|   3    | 空の王者風リボン          |
|   4    | ふわふわ代表リボン        |
|   5    | お触られマスターリボン    |

----
### リボンを贈呈する処理の作成
リボンと贈呈する処理を作ろう。  
処理の順番は以下かな。
* リボンのコードとリボン名を一覧表示
* リボンのコードを入力させる
* リボンを贈呈する動物のIDを入力させる
* 動物のIDから、動物のオブジェクトを探してくる
* リボン管理クラスにリボンのコードと動物のオブジェクトを登録する

----
### リボンの付与された動物の一覧表示処理の作成
リボン管理クラスから、リボンの付与された動物を取得して、一覧表示しよう。  
表示する内容は以下。
* リボン名
* リボンの付与された動物のID
* リボンの付与された動物の動物名
* リボンの付与された動物の体重

----
### 全動物一覧表示機能の修正
動物の一覧を表示を修正しよう。  
『檻に入っている動物のリボン名』の出力をペンディングしていたはず。  
リボン名も表示させよう。

----
### 単体テストをやってみよう
かわいい檻のクラスを対象に、  
カバレッジ100%となるように、JUnitを使ってテストしてみよう。  
ついでに、デバッグを経験してみようか。

…そういえば、そもそもなんで単体テストやるの？  

<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（DB編）

----
### DB使おう
アプリ終了したら、データ消えるじゃん。  
DBを使ってデータの永続化をしよう。  
あちこちにDB接続処理が散らばるのは嫌だから、  
DBAccessってクラスを作って、  
そこでDBアクセス処理を集中管理しよう。  
DBはpostgresqlというものを使おう。このDB、タダなの。  
他にもOracleDB（有料。高い。）、MySQL（タダ）とかあるよ。

----
### DBで管理するように改造しよう。
以下の順番でDB管理に変更していくよ。
* マスタテーブルを作成
* トランザクションテーブルを作成
* ファクトリクラスの大改造
* 檻クラスを大改造
* リボンの管理クラスを大改造

----
### マスタテーブルを作成（１）
檻のマスターテーブル（m_cage）を作成しよう。  
テーブルの仕様は以下にしよう。  
出来たらDBに４種類の檻の情報を登録しよう。  

| カラム名      | タイプ         | 説明               |
|:--------------|:---------------|:-------------------|
| cd            | integer        | コード             |
| name          | var char(50)   | 檻の名前           |
| type          | var char(100)  | 檻のクラスのFQCN   |

----
### マスタテーブルを作成（２）
動物のマスタテーブル（m_animal）を作成しよう。  
テーブルの仕様は以下にしよう。  
出来たらDBに４種類の動物の情報を登録しよう。  

| カラム名      | タイプ         | 説明               |
|:--------------|:---------------|:-------------------|
| cd            | integer        | コード             |
| name          | var char(50)   | 動物の名前         |
| type          | var char(100)  | 動物のクラスのFQCN |

----
### マスタテーブルを作成（３）
リボンのマスタテーブル（m_ribbon）を作成しよう。  
テーブルの仕様は以下にしよう。  
出来たら、DBに５種類のリボンの情報を登録しよう。  

| カラム名      | タイプ         | 説明               |
|:--------------|:---------------|:-------------------|
| cd            | integer        | コード             |
| name          | var char(50)   | リボンの名前       |

----
### トランザクションテーブルを作成（１）
檻に入れる動物を管理するトランザクションテーブル（t_cage_animal）を作ろう。  
テーブルの仕様は以下にしよう。

| カラム名      | タイプ         | 説明                   |
|:--------------|:---------------|:-----------------------|
| id            | serial         | 動物のID               |
| cage_cd       | integer        | 関連する檻のコード     |
| animal_cd     | integer        | 関連する動物のコード   |
| weight        | integer        | 動物の体重             |

----
### トランザクションテーブルを作成（２）
リボンとリボンの付与された動物を管理するトランザクションテーブル（t_ribbon_animal）を作ろう。  
テーブルの仕様は以下にしよう。

| カラム名      | タイプ         | 説明                     |
|:--------------|:---------------|:-------------------------|
| ribbon_cd     | integer        | リボンのコード           |
| animal_id     | integer        | 関連する動物の識別ID     |

----
### ファクトリクラスの大改造（１）
檻のファクトリクラスを改修しよう。  
檻のファクトリクラスでは、檻のコードや名前、オブジェクトを管理しているはず。  
その管理情報をDBから取得するように変更します。  
以下の順番で檻オブジェクトを生成して管理情報に登録しよう。  
* 檻マスターテーブルからデータ全件取得
* typeから檻オブジェクトを生成（Java Reflection）
* cdとnameを檻オブジェクトに設定して管理情報に登録

----
### ファクトリクラスの大改造（２）
動物のファクトリクラスを改修しよう。
動物のファクトリクラスでは、動物のコードや名前、クラス情報を管理しているはず。
その管理情報をDBから取得するように変更します。
手順は以下かな。
* 動物マスタテーブルからデータ全件取得
* typeから動物クラスのクラス情報を取得（Java Reflection）
* cdとnameとクラス情報を管理情報に登録

----
### 檻クラスを大改造（１）
檻クラスを改修しよう。  
檻に動物を登録する処理を作り変えます。  
手順は以下かな。
* 以下値をテーブル（t_cage_animal）へ登録
  * 檻のコード
  * 動物のコード
  * 動物の体重
* 檻クラスで管理している動物の管理用リストを削除

----
### 檻クラスを大改造（２）
続けて、檻内の動物のリスト取得処理を作り変えます。  
手順は以下かな。
* テーブル（t_cage_animal）から、檻のコードを指定してデータを全件取得
* 動物のコードから、動物のファクトリクラスで動物のオブジェクト取得
* オブジェクトに動物のIDと体重を設定
* リストにオブジェクトを登録
* データを全件、リストに登録し終わったら、リストを返却

----
### リボンの管理クラスを大改造（１）
リボンの管理クラスを改修しよう。  
リボン情報の管理を、DBから取得するように変更します。  
手順は以下かな。
* テーブル（m_ribbon）からデータ全件取得
* cdとnameを管理情報に登録

----
### リボンの管理クラスを大改造（２）
続けて、リボンを付与されている動物の管理をDBで行うように作り変えます。  
まずは、リボンの贈呈処理から。手順は以下かな。
* テーブル（t_ribbon_animal）からデータ全件取得
* 贈呈しようとしているリボンが贈呈済みの場合
  * テーブル（t_ribbon_animal）の当該リボンの動物のIDをUpdate
* 設定済みではない場合
  * テーブル（t_ribbon_animal）に当該リボンと動物のIDをInsert
* リボンを付与されている動物の一覧の管理用マップを削除

----
### リボンの管理クラスを大改造（３）
次は、リボンを付与されている動物の一覧を取得する処理を作り変えます。  
手順は以下かな。
* テーブル（t_ribbon_animal）とテーブル（t_cage_animal）を内部結合してデータ全件取得
* 取得したリボン情報と動物の情報をそれぞれ一覧化し、返却。

----
### 全動物リスト表示処理を改修
全動物リスト表示処理をDBの外部結合を使って作り変えよう。

手順は以下かな。
* テーブル（t_cage_animal）とテーブル（m_cage）を内部結合、さらにテーブル（t_ribbon_animal）を外部結合してデータ全件取得
* 全データを出力

----
### DBの単体テストをしてみよう（１）
DBUnitを使って、DBAccess#getCagesを対象に単体テストをしてみましょう。
手順は以下だ。
* DBUnitを依存関係に追加
* DBAccessTest.javaを作成
* DBAccess#getCagesのテストメソッドを作成
* こっからは一緒にやろうか

----
### DBの単体テストをしてみよう（２）
次は、DBAccess#addAnimalToCageを対象に単体テストをしてみましょう。
手順は以下だ。
* DBAccess#addAnimalToCageのテストメソッドを作成
* こっからは一緒にやろうか
