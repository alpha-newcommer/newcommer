# Java講習



<!-- Javaの実行とライブラリ使用まで -->

>>>>
## 基本編

----
### はろーわーるど　かけるよね？
IDEなんて使わせないよ？  
テキストエディタとコマンドプロンプトで頑張れ。  
* 適当に「work\hello」フォルダを作ろう。ココ、以降はbaseフォルダって言います。
* package は 『com.sample.app』 で作ってね。
* 文字コードは『UTF-8』で作ってね。

----
### Java実行時の引数を表示してみよう。
* さっきの "はろーわーるど" の横に引数の値を足そうか。

----
### 実行時引数の指定忘れ対策しよう。
例外スタック垂れ流しはダサい。  
* "引数が指定されていません。"ってエラー出力をしよう。

----
### 便利ライブラリでもっと格好よく
まだダサい。  
引数（配列）が空の場合の処理を便利ライブラリのcommons-lang3のAPIに置き換えよう。  
* [commons-lang3のjar](https://mvnrepository.com/artifact/org.apache.commons/commons-lang3/3.7)
からjarをダウンロードして、baseフォルダ下の「lib」フォルダ配下に置こう。
* [commons-lang3のAPI](https://commons.apache.org/proper/commons-lang/javadocs/api-3.4/)
でArrayUtilsあたりを調べて、空かどうか判定するようソースを書き換えよう。



<!-- IO処理 -->

>>>>
## IO編

----
### ファイル内容でも出力してみようか。
適当なテキストファイルを作って出力してみよう。  
* テキスト内容は3行以上書いてね。
* baseフォルダ配下にファイルは置いてね。
* [Java8のAPI](https://docs.oracle.com/javase/jp/8/docs/api/)
  の「java.io」パッケージ下の以下クラスを使ってコーディングしよう。
  + FileReader
  + BufferedReader

----
### Javaにおけるストリームを理解しよう
Javaプログラムの入出力を「ストリーム」と呼んでいます。  
ファイル然り、ネットワーク然り、コンソールの入出力然り、
Javaプログラムとプログラム外との文字やデータの入出力（Input/Output 以降"IO"）の概念をストリームと言います。

----
### コンソール入力を受付けよう
今度は、ファイルではなく、コンソールの入力ストリームを使ってみよう。
* コンソール入力は、以下を組み合わせて使うといいよ。
  + System.in （コンソールの入力ストリーム）
  + InputStreamReader
  + BufferedReader
* 「ファイルパスを入力してください。＞」と出力し、その横にユーザ入力させましょう。
* 入力されたファイルパスの内容を出力しよう。



<!-- 環境構築 -->

>>>>
## 環境構築編

----
### 開発環境を整えよう（STS）
まだIDE使ってないとかダサい。  
STSというIDE使いましょう。
* STSをダウンロードして、自端末に展開してSTSを起動しよう。
* さっきまで作っていたアプリ（Javaプロジェクト）をimportしよう。
* ビルドパス等々の設定をしよう。
* 実行してみよう。

----
### 開発環境を整えよう（Maven）
まだ手動で設定とかしてるの？ださい。  
Mavenというプロジェクト管理ツールを使おう。
* STSにはMavenプラグインがあるため、Mavenのインストールは不要。
* 以下コマンドを「work」フォルダで実行し、Mavenプロジェクトを作ろう

``` bat
mvn archetype:generate ^
-DarchetypeGroupId=org.apache.maven.archetypes ^
-DarchetypeArtifactId=maven-archetype-quickstart ^
-DgroupId=com.example ^
-DartifactId=ishinoy-zoo-app ^
-Dversion=1.0-SNAPSHOT
```



<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（アプリ仕様）

----
### 作成するアプリの概要
以下のような動物園アプリを作ってもらいます。
* 色々な檻に色々な動物を入れます。
* 5種のリボンを檻の中の5頭の動物に付けられます。
* 全ての檻と、檻に入っている動物の一覧表示をします。
* 5種のリボン付き動物の一覧を表示します。

----
### 檻の基本仕様
色々な種類の檻がありますが、基本は以下の仕様に則ります。
* 檻に動物を入れる際は、動物の種族名と体重を指定します。
* 檻には色々な制限があり、違反する場合は動物を入れられません。（個体体重、総重量、総数等）

----
### 動物の基本仕様
色々な動物がいます。  
基本は以下の情報を持ちます。
* 個体識別ID
* 種族名
* 体重（kg）

----
### リボンの基本仕様
以下の5種類のリボンがあります。  
1個ずつ、5頭の動物へ付けることが出来ます。
* 草食アイドルリボン
* 肉食系女子リボン
* 空の王者風リボン
* ふわふわ代表リボン
* お触られマスターリボン



<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（作成）
以下の４つを意識して作っていきましょう。
* ポリモーフィズム
* カプセル化
* 継承
* ファクトリ

----
### 作成工程
以下の工程で作成していきましょ。
* メニューの作成（入力受付け処理部分）
* 動物の作成
* 檻の作成
* 動物を檻に入れる処理の作成
* 全動物一覧表示機能の作成
* リボンの作成
* 動物にリボンを贈呈する処理の作成
* リボン付動物一覧表示機能の作成

----
### メニューの作成
概要から、以下のメニューが必要そう。
* 1:檻に動物を入れる
* 2:動物にリボン贈呈
* 3:全動物リスト表示
* 4:リボン付き動物リスト表示

各番号が入力されたら、それぞれの処理を行うよう、
入力受付け及び分岐処理を作ろう。  
処理内容は…、とりあえず今は、処理名でも出力しておこう。

----
### 動物の作成
檻に入れる動物のクラスを作ろう。
とりあえず、以下の動物クラスを作ろう。
* 種族名：トラ
* 種族名：シマウマ
* 種族名：ウサギ
* 種族名：フクロウ

----
### 檻の作成
以下の仕様の檻クラスを作ろう。

| 檻名          | 制限                       |
|:--------------|:---------------------------|
| 普通の檻      | 250kgまでの動物2頭まで。   |
| 頑丈な檻      | 3頭まで。                  |
| 広い檻        | 総重量1000kgまで。         |
| かわいい檻    | 1匹2kgまで。               |

----
### 動物を檻に入れる処理の作成（１）
檻に動物を入れてみよう。  
処理の順番は以下かな。  
* 檻にコードを設定する。
* 使用可能な檻とそのコードを一覧表示し、使用する檻のコードを入力させる  
  ⇒ コードから檻のオブジェクト取得する  

----
### 動物を檻に入れる処理の作成（２）
続けて、入れる動物の種族名と体重を入力させよう  
処理の順番は以下かな。  
* 動物の種類にコードを設定する。
* 動物の種類名とそのコードを一覧表示し、コードを入力させる  
  ⇒ コードから動物のオブジェクト取得する（個体識別IDも振っておこう）  
* 動物の体重を入力させる
* 檻にその動物を格納可能かチェックする
* チェックNGなら警告を出力し、最初のメニューへ戻る
* チェックOKならその動物を檻に格納し、最初のメニューへ戻る

----
### 全動物一覧表示機能の作成
動物の一覧を表示しよう。
表示する内容は以下。
* 檻名
* 檻に入っている動物の個体識別ID
* 檻に入っている動物の種族名
* 檻に入っている動物の体重
* 檻に入っている動物のリボン名（今は空白でOK）

----
### リボン管理クラスの作成
以下の5種類のリボンと、そのリボンを付与されている動物のオブジェクトを管理するクラスを作ろう。

| リボン名                  |
|:--------------------------|
| 草食アイドルリボン        | 
| 肉食系女子リボン          |
| 空の王者風リボン          |
| ふわふわ代表リボン        |
| お触られマスターリボン    |
 

----
### リボンを贈呈する処理の作成
リボンと贈呈する処理を作ろう。  
処理の順番は以下かな。
* リボン名とコードを一覧表示し、コードを入力させる
* 対象の動物の個体識別IDを入力させる
* リボン管理クラスに対象のリボンと動物を登録する

----
### リボンの付与された動物の一覧表示処理の作成
リボン管理クラスから、リボンの付与された動物を取得して、一覧表示しよう。
表示する内容は以下。
* リボン名
* リボンの付与された動物の個体識別ID
* リボンの付与された動物の種族名
* リボンの付与された動物の体重

----
### 全動物一覧表示機能の修正
動物の一覧を表示を修正しよう。
『檻に入っている動物のリボン名』の出力をペンディングしていたはず。
リボン名も表示させよう。

----
### 単体テストをやってみよう
かわいい檻のクラスを対象に、カバレッジ100%となるように、JUnitを使ってテストしてみよう。  
…そういえば、そもそもなんで単体テストやるの？


<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（DB編）

----
### DB使おう
アプリ終了したら、データ消えるじゃん。  
DBを使ってデータの永続化をしよう。  
あちこちにDB接続処理が散らばるのは嫌だから、DBAccessってクラスを作って、
そこでDBアクセス処理を集中管理しよう。  
DBはpostgresqlというものを使おう。このDB、タダなの。

----
### DBで管理するように改造しよう。
以下の順番でDB管理に変更していくよ。
* マスタテーブルを作成
* トランザクションテーブルを作成
* ファクトリクラスの大改造
* 檻クラスを大改造
* リボンの管理クラスを大改造

----
### マスタテーブルを作成（１）
檻の名前と檻のクラスを紐付けるマスターテーブル（m_cage）を作成しよう。  
テーブルの仕様は以下にしよう。  
出来たらDBに４種類の檻の情報を登録しよう。  

| カラム名      | タイプ         | 説明               |
|:--------------|:---------------|:-------------------|
| cd            | integer        | コード             |
| name          | var char(50)   | 檻の名前           |
| type          | var char(100)  | 檻のクラスのFQCN   |

----
### マスタテーブルを作成（２）
動物のマスタテーブル（m_animal）を作成しよう。  
テーブルの仕様は以下にしよう。  
出来たらDBに４種類の動物の情報を登録しよう。  

| カラム名      | タイプ         | 説明               |
|:--------------|:---------------|:-------------------|
| cd            | integer        | コード             |
| name          | var char(50)   | 動物の名前         |
| type          | var char(100)  | 動物のクラスのFQCN |

----
### マスタテーブルを作成（３）
リボンのマスタテーブル（m_ribbon）を作成しよう。  
テーブルの仕様は以下にしよう。  
出来たら、DBに５種類のリボンの情報を登録しよう。  

| カラム名      | タイプ         | 説明               |
|:--------------|:---------------|:-------------------|
| cd            | integer        | コード             |
| name          | var char(50)   | リボンの名前       |

----
### トランザクションテーブルを作成（１）
檻に入れる動物を管理するトランザクションテーブル（t_cage_animal）を作ろう。  
テーブルの仕様は以下にしよう。

| カラム名      | タイプ         | 説明                   |
|:--------------|:---------------|:-----------------------|
| id            | serial         | 動物の識別ID           |
| cage_cd       | integer        | 関連する檻のコード     |
| animal_cd     | integer        | 関連する動物のコード   |
| weight        | integer        | 動物の体重             |

----
### トランザクションテーブルを作成（２）
リボンとリボンの付与された動物を管理するトランザクションテーブル（t_ribbon_animal）を作ろう。  
テーブルの仕様は以下にしよう。

| カラム名      | タイプ         | 説明                     |
|:--------------|:---------------|:-------------------------|
| id            | serial         | リボンの個体識別ID       |
| ribbon_cd     | integer        | リボンの名前             |
| animal_id     | integer        | 関連する動物の識別ID     |


----
### ファクトリクラスの大改造（１）
檻のファクトリクラスを改修しよう。  
檻の管理情報をDBから取得するように変更します。  
以下の順番で檻オブジェクトを生成して管理情報に登録しよう。  
* 檻マスターテーブルからデータ全件取得
* typeから檻オブジェクトを生成（Java Reflection）
* cdとnameを檻オブジェクトに設定して管理情報に登録

----
### ファクトリクラスの大改造（２）
動物のファクトリクラスを改修しよう。
動物の種類のコードとクラスの管理情報をDBから取得するように変更します。
手順は以下かな。
* 動物マスタテーブルからデータ全件取得
* typeから動物クラスのクラス情報を取得（Java Reflection）
* cdとnameとクラス情報をリストに登録

----
### 檻クラスを大改造（１）
檻クラスを改修しよう。  
檻に動物を登録する処理を作り変えます。  
手順は以下かな。
* 檻のコード、動物の種類のコード、体重を指定して、テーブル（t_cage_animal）へ登録
* 檻クラスで管理している動物の管理用リストを削除

----
### 檻クラスを大改造（２）
続けて、檻内の動物のリストを取得処理を作り変えます。  
手順は以下かな。
* テーブル（t_cage_animal）から、檻のコードを指定してデータを取得
* テーブル（m_animal）からanimal_cdを元にtypeを取得し、動物クラス情報を取得
* 動物クラス情報からオブジェクトを作成（Java Reflection）
* オブジェクトに取得したデータを設定
* リストにオブジェクトを登録して、リストを返却

----
### リボンの管理クラスを大改造（１）
リボンの管理クラスを改修しよう。  
リボンの種類の管理情報をDBから取得するように変更します。  
手順は以下かな。
* テーブル（m_ribbon）からデータ全件取得
* cdとnameを管理情報に登録

----
### リボンの管理クラスを大改造（２）
続けて、リボンを設定している動物の一覧取得処理を作り変えます。  
手順は以下かな。
* テーブル（t_ribbon_animal）とテーブル（t_cage_animal）を内部結合してデータ全件取得
* 取得したリボン種の情報と動物の情報をそれぞれ一覧化し、返却。

----
### リボンの管理クラスを大改造（３）
さらに続けて、動物へのリボンの設定処理を作り変えます。  
手順は以下かな。
* テーブル（t_ribbon_animal）からデータ全件取得
* 設定しようとしているリボンが設定済みの場合
  * テーブル（t_ribbon_animal）の当該リボンの動物の識別IDをUpdate
* 設定済みではない場合
  * テーブル（t_ribbon_animal）に当該リボンと動物の識別IDをInsert
* リボンと動物の管理マップを削除

----
### 全動物リスト表示処理を改修
全動物リスト表示処理をDBの外部結合を使って作り変えよう。

手順は以下かな。
* テーブル（t_cage_animal）とテーブル（m_cage）を内部結合、さらにテーブル（t_ribbon_animal）を外部結合してデータ全件取得
* 全データを出力
