# Java講習



<!-- Javaの実行とライブラリ使用まで -->

>>>>
## 基本編

----
### はろーわーるど　かけるよね？
IDEなんて使わせないよ？  
テキストエディタとコマンドプロンプトで頑張れ。  
* 適当に「work\hello」フォルダを作ろう。ココ、以降はbaseフォルダって言います。
* package は 『com.sample.app』 で作ってね。
* 文字コードは『UTF-8』で作ってね。

----
### Java実行時の引数を表示してみよう。
* さっきの "はろーわーるど" の横に引数の値を足そうか。

----
### 実行時引数の指定忘れ対策しよう。
例外スタック垂れ流しはダサい。  
* "引数が指定されていません。"ってエラー出力をしよう。

----
### 便利ライブラリでもっと格好よく
まだダサい。  
引数（配列）が空の場合の処理を便利ライブラリのcommons-lang3のAPIに置き換えよう。  
* [commons-lang3のjar](https://mvnrepository.com/artifact/org.apache.commons/commons-lang3/3.7)
からjarをダウンロードして、baseフォルダ下の「lib」フォルダ配下に置こう。
* [commons-lang3のAPI](https://commons.apache.org/proper/commons-lang/javadocs/api-3.4/)
でArrayUtilsあたりを調べて、空かどうか判定するようソースを書き換えよう。



<!-- IO処理 -->

>>>>
## IO編

----
### ファイル内容でも出力してみようか。
適当なテキストファイルを作って出力してみよう。  
* テキスト内容は3行以上書いてね。
* baseフォルダ配下にファイルは置いてね。
* [Java8のAPI](https://docs.oracle.com/javase/jp/8/docs/api/)
  の「java.io」パッケージ下の以下クラスを使ってコーディングしよう。
  + FileReader
  + BufferedReader

----
### Javaにおけるストリームを理解しよう
Javaプログラムの入出力を「ストリーム」と呼んでいます。  
ファイル然り、ネットワーク然り、コンソールの入出力然り、
Javaプログラムとプログラム外との文字やデータの入出力（Input/Output 以降"IO"）の概念をストリームと言います。

----
### コンソール入力を受付けよう
今度は、ファイルではなく、コンソールの入力ストリームを使ってみよう。
* コンソール入力は、以下を組み合わせて使うといいよ。
  + System.in （コンソールの入力ストリーム）
  + InputStreamReader
  + BufferedReader
* 「ファイルパスを入力してください。＞」と出力し、その横にユーザ入力させましょう。
* 入力されたファイルパスの内容を出力しよう。



<!-- 環境構築 -->

>>>>
## 環境構築編

----
### 開発環境を整えよう（STS）
まだIDE使ってないとかダサい。  
STSというIDE使いましょう。
* STSをダウンロードして、自端末に展開してSTSを起動しよう。
* さっきまで作っていたアプリ（Javaプロジェクト）をimportしよう。
* ビルドパス等々の設定をしよう。
* 実行してみよう。

----
### 開発環境を整えよう（Maven）
まだ手動で設定とかしてるの？ださい。  
Mavenというプロジェクト管理ツールを使おう。
* STSにはMavenプラグインがあるため、Mavenのインストールは不要。
* 以下コマンドを「work」フォルダで実行し、Mavenプロジェクトを作ろう

``` bat
mvn archetype:generate ^
-DarchetypeGroupId=org.apache.maven.archetypes ^
-DarchetypeArtifactId=maven-archetype-quickstart ^
-DgroupId=com.example ^
-DartifactId=ishinoy-zoo-app ^
-Dversion=1.0-SNAPSHOT
```



<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（アプリ仕様）

----
### 作成するアプリの概要
以下のような動物園アプリを作ってもらいます。
* 色々な檻に色々な動物を入れます。
* 5種のリボンを檻の中の5頭の動物に付けられます。
* 全ての檻と、檻に入っている動物の一覧表示をします。
* 5種のリボン付き動物の一覧を表示します。

----
### 檻の基本仕様
色々な種類の檻がありますが、基本は以下の仕様に則ります。
* 檻に動物を入れる際は、動物の種族名と体重を指定します。
* 檻には色々な制限があり、違反する場合は動物を入れられません。（個体体重、総重量、総数等）

----
### 動物の基本仕様
色々な動物がいます。  
基本は以下の情報を持ちます。
* 個体識別ID
* 種族名
* 体重（kg）

----
### リボンの基本仕様
以下の5種類のリボンがあります。  
1個ずつ、5頭の動物へ付けることが出来ます。
* 草食アイドルリボン
* 肉食系女子リボン
* 空の王者風リボン
* ふわふわ代表リボン
* お触られマスターリボン



<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（作成）
以下の４つを意識して作っていきましょう。
* ポリモーフィズム
* カプセル化
* 継承
* ファクトリ

----
### 作成工程
以下の工程で作成していきましょ。
* メニューの作成（入力受付け処理部分）
* 動物の作成
* 檻の作成
* 動物を檻に入れる処理の作成
* 全動物一覧表示機能の作成
* リボンの作成
* 動物にリボンを贈呈する処理の作成
* リボン付動物一覧表示機能の作成

----
### メニューの作成
概要から、以下のメニューが必要そう。
* 1:檻に動物を入れる
* 2:動物にリボン贈呈
* 3:全動物リスト表示
* 4:リボン付き動物リスト表示

各番号が入力されたら、それぞれの処理を行うよう、
入力受付け及び分岐処理を作ろう。  
処理内容は…、とりあえず今は、処理名でも出力しておこう。

----
### 動物の作成
檻に入れる動物のクラスを作ろう。
とりあえず、以下の動物クラスを作ろう。
* 種族名：トラ
* 種族名：シマウマ
* 種族名：ウサギ
* 種族名：フクロウ

----
### 檻の作成
檻のクラスを作ろう。  
とりあえず、以下の仕様の檻クラスを作ろう。

| 檻名          | 制限                       |
|:--------------|:---------------------------|
| 普通の檻      | 250kgまでの動物2頭まで。   |

----
### 続・檻の作成
追加で、以下の仕様の檻クラスを作ろう。

| 檻名          | 制限                       |
|:--------------|:---------------------------|
| 頑丈な檻      | 3頭まで。                  |
| 広い檻        | 総重量1000kgまで。         |
| かわいい檻    | 1匹2kgまで。               |

----
### 動物を檻に入れる処理の作成（１）
檻に動物を入れてみよう。
処理の順番は以下かな。  
* 1 使用可能な檻を一覧表示し、使用する檻を入力させる  
  ⇒ 檻のオブジェクト取得する  

----
### 動物を檻に入れる処理の作成（２）
* 2 入れる動物の種族名と体重を入力させる  
  ⇒ 以下を実施
  * 動物のオブジェクトを生成する  
  * 檻にその動物を格納可能かチェックする
  * チェックNGなら警告を出力し、最初のメニューへ戻る
  * チェックOKならその動物を檻に格納し、最初のメニューへ戻る

----
### 全動物一覧表示機能の作成
動物の一覧を表示しよう。
表示する内容は以下。
* 檻名
* 檻に入っている動物の個体識別ID
* 檻に入っている動物の種族名
* 檻に入っている動物の体重
* 檻に入っている動物のリボン名（今は空白でOK）

----
### リボン管理クラスの作成
5種類のリボンと、そのリボンを付与されている動物のオブジェクトを
以下の例のように管理するクラスを作ろう。

| リボン名                  | 動物             |
|:--------------------------|:-----------------|
| 草食アイドルリボン        | null（設定無し） |
| 肉食系女子リボン          | トラ             |
| 空の王者風リボン          | null             |
| ふわふわ代表リボン        | ウサギ           |
| お触られマスターリボン    | null             |
 

----
### リボンを贈呈する処理の作成
リボンと贈呈する処理を作ろう。  
処理の順番は以下かな。
* 1 リボン名を一覧表示する
* 2 対象のリボンを選択させる
* 3 対象の動物の個体識別IDを入力させる
* 4 リボン管理クラスに対象のリボンと動物を登録する

----
### リボンの付与された動物の一覧表示処理の作成
リボン管理クラスから、リボンの付与された動物を取得して、一覧表示しよう。
表示する内容は以下。
* リボン名
* リボンの付与された動物の個体識別ID
* リボンの付与された動物の種族名
* リボンの付与された動物の体重

----
### 全動物一覧表示機能の修正
動物の一覧を表示を修正しよう。
『檻に入っている動物のリボン名』の出力をペンディングしていたはず。
リボン名を表示しよう。

<!-- IF/Abst含めた複合 -->

>>>>
## 実践編（DB編）

----
### DB使おう
アプリ終了したら、データ消えるじゃん。  
DBを使ってデータの永続化をしよう。
あちこちにDB接続処理が散らばるのは嫌だから、DBAccessってクラスを作って、
そこでDBアクセス処理を集中管理しよう。

以下の順番でDB管理に変更していくよ。
* 檻のマスタテーブルを作成
* 動物のマスターテーブルを作成
* 動物の管理用トランザクションテーブルを作成
* 動物のファクトリクラスの大改造
* 檻で管理する動物の一覧をテーブル化
* 動物の一覧をテーブル化
* リボンのマスターテーブルを作成
* リボン月のド物の一覧をテーブル化

----
### 檻のマスタテーブルを作成しよう（１）
現在、檻のオブジェクトを管理しているクラス（檻のファクトリクラス）で、
檻の名前とオブジェクトをMapに登録しているね？  
ソコをDBを使うように改良しよう。  
では、まず檻のマスタテーブルを作成しよう。  
テーブルの仕様は以下にしよう。
* テーブル名：m_cage
| カラム名      | タイプ                  |
|:--------------|:------------------------|
| id            | serial                  |
| name          | character varying(50)   |
| type          | character varying(100)  |

id は檻の識別ID。  
nameは檻の名前だ。  
typeには檻のクラスのFQCN（jp.co.alpha.zoo.cage.CuteCage みたいの）を設定する。  
テーブルが出来たら、DBに４つの檻の情報を登録しよう。  

----
### 檻のマスタテーブルを作成しよう（２）
檻のファクトリクラスの、檻の管理Mapの登録処理を改修しよう。  
檻のマスタテーブルからデータを全件取得し、以下の順番で檻オブジェクトを生成してMapに登録しよう。  
* 檻のクラスにidフィールドが無い人は、追加しておこう。  
* Javaリフレクションを使って、取得したデータのtypeの文字列から檻オブジェクトを生成しよう。
* データのnameをキー、生成したオブジェクトを値として、Mapに登録しよう。

----
### 動物のマスタテーブルを作成しよう

動物のマスタテーブルを作成しよう。  
テーブルの仕様は以下にしよう。  
* テーブル名：m_animal
| カラム名      | タイプ                  |
|:--------------|:------------------------|
| id            | serial                  |
| name          | character varying(50)   |

id は動物の識別ID。  
nameは動物の名前だ。  
テーブルが出来たら、DBに４種類の動物の情報を登録しよう。  

----
### 動物の管理用トランザクションテーブルを作成しよう
動物の種族名と体重を管理するトランザクションテーブルを作ろう。  
テーブルの仕様は以下にしよう。
* テーブル名：t_animal
| カラム名      | タイプ                  |
|:--------------|:------------------------|
| id            | serial                  |
| animal_id     | integer                 |
| weight        | integer                 |

id は動物の識別ID。  
animal_id は動物のマスターテーブルの識別IDだ。 マスタと紐づけを行うんだ。 
weight は動物の体重だ。


----
### 動物のファクトリクラスの大改造（１）
動物のファクトリクラスで管理していた動物の名前とクラスの管理マップを削除しよう。  
そして、動物マスタ情報を保持するクラスを作り、動物ファクトリクラスの
動物のマスタ情報を保持するリストを作ろう。  
手順は以下かな。
* 動物の名前とクラスの管理マップを削除
* 動物マスタ情報クラス作成
* 動物マスタ情報の管理リスト作成
* 動物のマスタテーブルより全データを取得し、動物マスタ情報オブジェクトを作成しリストへ登録

### 動物のファクトリクラスの大改造（２）
さて、動物のトランザクションテーブルを作ってしまうと…  
どうだろう？動物のインターフェースや各種動物クラスは不要ではないだろうか。  
ってわけで、動物のクラスもインターフェースも全部削除しよう。  
そして、動物のトランザクション情報を保持する動物クラスを作ろう。 
動物の生成処理と指定の動物取得処理も書き換えよう。  
手順は以下かな。
* 動物のクラスとインターフェースを全部削除
* 動物のトランザクション情報を保持する動物クラスを作成
* 動物ファクトリクラスから生成した動物の管理マップを削除
* 動物の生成処理を変更
  * 動物クラスのオブジェクト生成
  * 生成した動物オブジェクトに、動物マスタ情報のIDと体重を設定
  * DBへ登録
* 指定の動物オブジェクト取得処理を、DBから指定のIDを取得処理に変更

以下、略（TODO）！
